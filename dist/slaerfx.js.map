{"version":3,"file":"slaerfx.js","sources":["../source/core/config.js","../source/core/utils.js","../source/core/objects.js","../source/core/entities.js","../source/core/behaviours.js","../source/core/engine.js","../source/index.js"],"sourcesContent":["\r\nvar settings = {\r\n  autorun: true\r\n};\r\n\r\nexport function configure(name, value) {\r\n    settings[name] = value;\r\n};\r\n\r\nexport function config(name) {\r\n    if (name) {\r\n      return settings[name];\r\n    }\r\n    \r\n    return settings;\r\n};\r\n\r\n","\r\n/*!\r\nExtends {out} from one or more other objects (L <-- R).\r\nThis function preserves any existing keys.\r\n\r\n@returns out\r\n*/\r\nexport function extend(out) {\r\n  var i = arguments.length;\r\n\r\n  while (0 <-- i) {\r\n    for (var key in arguments[i]) {\r\n      // Preserve exxisting keys\r\n      if (typeof out[key] === 'undefined') {\r\n        out[key] = arguments[i][key];\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/*!\r\nMerges one or more objects over {out} (L --> R)\r\nThis function overwrites any existing properties.\r\n\r\n@returns out\r\n*/\r\nexport function merge(out) {\r\n  for (var i = 1, N = arguments.length; i < N; i++) {\r\n    for (var key in arguments[i]) {\r\n      out[key] = arguments[i][key];\r\n    }\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\n/*!\r\nExtends an object based on the results from a merge operation.\r\n*/\r\nexport function mergeExtend(out) {\r\n  // FIXME: Use ES2015 spread syntax\r\n  return extend(out, merge.apply(null, [{}].concat(Array.prototype.slice.call(arguments, 1))));\r\n}\r\n","\r\nimport { extend, merge } from './utils';\r\n\r\nvar annonymous = 0;\r\n\r\nexport function object(name, components) {\r\n  if (name && typeof name !== 'string') {\r\n    components = name;\r\n    name = \"obj#\" + annonymous++;\r\n  }\r\n\r\n  var inst = SlaerObject.instances[name] || new SlaerObject(name, components);\r\n\r\n  if (components && inst.components !== components) {\r\n    merge(inst.components, components);\r\n  }\r\n\r\n  return inst;\r\n};\r\n\r\nexport function objects() {\r\n  return SlaerObject.instances;\r\n}\r\nobjects._reset = function() {\r\n   SlaerObject.instances = {};\r\n}\r\n\r\n//----------------------------------------------------------\r\n// INTERNALS\r\n//----------------------------------------------------------\r\n\r\n\r\nfunction SlaerObject(name, components) {\r\n  this.name = name;\r\n  this.components = components || {};\r\n\r\n  SlaerObject.instances[name] = this;\r\n}\r\n\r\nSlaerObject.instances = {};\r\n\r\nSlaerObject.prototype.clone = function(name, components) {\r\n  return new SlaerObject(name, extend({}, this.components, components));\r\n};\r\n","/*!\r\nEntities represents the the types of things that can exist in the virtual world.\r\nRather thaan being the actual things themselves, they more describe what things can be.\r\n\r\nFor example, a \"bullet\" could be an entity with some inital default velocity and position.\r\nBut object \"bullet#18765\" is a specific instance of a bullet.\r\n\r\nEntities allow you to define an object template, consisting of a set of inital, default components, flags and/or behaviours.\r\n*/\r\n\r\nimport { extend, merge } from './utils';\r\n\r\nvar annonymous = 0;\r\n\r\nexport function entity(name, components) {\r\n  if (name && typeof name !== 'string') {\r\n    components = name;\r\n    name = \"ent#\" + annonymous++;\r\n  }\r\n\r\n  var inst = SlaerEntity.instances[name] || new SlaerEntity(name, components);\r\n\r\n  if (components && inst.components !== components) {\r\n    merge(inst.components, components);\r\n  }\r\n\r\n  return inst;\r\n};\r\n\r\nexport function entities() {\r\n  return SlaerEntity.instances;\r\n}\r\nentities._reset = function() {\r\n   SlaerEntity.instances = {};\r\n}\r\n\r\n\r\n//----------------------------------------------------------\r\n// INTERNALS\r\n//----------------------------------------------------------\r\n\r\nimport { object } from './objects';\r\n\r\nfunction SlaerEntity(name, components) {\r\n  this.name = name;\r\n  this.components = components || {};\r\n\r\n  SlaerEntity.instances[name] = this;\r\n}\r\n\r\nSlaerEntity.instances = {};\r\n\r\nSlaerEntity.prototype.create = function(name, components) {\r\n  return object(name, extend({}, this.components, components || {}));\r\n};\r\n\r\n","\r\nvar instances = {};\r\n\r\nexport function behaviour(name, inst) {\r\n  \r\n  inst._name = name;\r\n  \r\n  return instances[name] = inst;\r\n};\r\nexport function behaviours() {\r\n  return instances;\r\n};\r\nbehaviours._reset = function() {\r\n   instances = {};\r\n}\r\n","\r\n\r\nimport { objects } from './objects';\r\nimport { entities } from './entities';\r\nimport { behaviours } from './behaviours';\r\n\r\nvar runToken = null;\r\n\r\n/*!\r\nStarts the engine.\r\n*/\r\nexport function start() {\r\n  var _objects = objects();\r\n  var _behaviours = behaviours();\r\n\r\n  var now = new Date().getTime(), then = now, dt = 0;\r\n\r\n  (function loop() {\r\n    then = now;\r\n    now = new Date().getTime();\r\n    dt = Math.min((now - then) / 1000.0, 0.1);\r\n\r\n    var canvas = document.getElementsByTagName('canvas')[0];\r\n    canvas.width = canvas.width;\r\n    canvas.height = canvas.height;\r\n\r\n    for (var key in _objects) {\r\n      for (var component in _objects[key].components) {\r\n        if (component[0] === '_') {\r\n          continue;\r\n        }\r\n\r\n        if (_behaviours[component]) {\r\n          _behaviours[component].call(_objects[key], dt, _objects[key].components[component]);\r\n        }\r\n        else if (typeof _objects[key].components[component] === 'function') {\r\n          _objects[key].components[component].call(_objects[key].components, dt);\r\n        }\r\n      }\r\n    }\r\n    \r\n    runToken = window.requestAnimationFrame(loop);\r\n  }());\r\n}\r\n\r\n/*!\r\nStops the engine running\r\n*/\r\nexport function stop() {\r\n  window.cancelAnimationFrame(runToken);\r\n}\r\n\r\n/*!\r\nWipes the data and restarts the engine.\r\n*/\r\nexport function reset() {\r\n  objects._reset();\r\n  entities._reset();\r\n  behaviours._reset();\r\n}\r\n","\r\n/// The version number\r\n//export const version = VERSION;\r\n\r\n// Export the api modules\r\nexport * from './core/config';\r\nexport * from './core/entities';\r\nexport * from './core/objects';\r\nexport * from './core/behaviours';\r\nexport * from './core/engine';\r\nexport * from './core/utils';\r\n\r\n// Import the stuf we need\r\nimport { config } from './core/config';\r\nimport { start } from './core/engine';\r\n\r\n// Initialise the bootstrapper\r\nwindow.addEventListener('load', function() {\r\n  if (config('autorun')) {\r\n    start();\r\n  }\r\n});\r\n"],"names":["annonymous"],"mappings":"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"}